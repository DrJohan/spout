<html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="data:image/vnd.microsoft.icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABMLAAATCwAAAAAAAAAAAAAAAAAAAAAAIAAAAMIAAAAiAAAAAAAAAAAAAAAAAAAARAAAAEEAAAAcAAAAwQAAACEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAADCAAAAIgAAAAAAAAAAAAAAAAAAAEQAAABBAAAAHAAAAMEAAAAhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAwwAAACIAAAAAAAAAAAAAAAAAAABEAAAAQQAAABwAAADBAAAAIQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAKoAAAAeAAAAAAAAAAAAAAAAAAAARAAAAEEAAAAYAAAAqwAAAB4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAWAAAACAAAAB8AAAAfAAAAAAAAAEQAAABDAAAAAAAAABgAAAAIAAAAHQAAAB0AAAAEAAAAAAAAAAAAAAAAAAAAAAAAABkAAACuAAAArQAAABQAAABCAAAAQwAAAAAAAAAAAAAAGAAAAK0AAACrAAAAFgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGQAAABkAAAAAAAAARAAAAEMAAAAAAAAAAAAAAAMAAAAZAAAAGQAAAAMAAAAAAAAATAAAAEwAAABOAAAATAAAAEoAAABKAAAASQAAAHwAAAB7AAAASgAAAEwAAABMAAAASgAAAEoAAABMAAAATAAAAFAAAABnAAAA0AAAAGcAAABRAAAAUgAAAE8AAACAAAAAfgAAAE0AAABQAAAAUAAAAFAAAABSAAAAUgAAAFIAAAAAAAAAIAAAAL8AAAAfAAAAAAAAAAAAAAAAAAAARQAAAFkAAAAbAAAAHgAAAB8AAAAbAAAABAAAAAAAAAAAAAAAAAAAACAAAAC/AAAAHwAAAAIAAAAXAAAAAAAAAEgAAADPAAAAwwAAAMMAAADFAAAArAAAABgAAAAAAAAAAAAAAAAAAAAgAAAAvwAAAB4AAAAcAAAAqwAAABkAAABDAAAAWgAAAB0AAAAgAAAAHwAAABsAAAAEAAAAAAAAAAAAAAAAAAAAHAAAAKgAAAAaAAAAIAAAAMMAAAAdAAAAQgAAAEMAAAAAAAAABAAAABsAAAAfAAAAIAAAACEAAAAhAAAAAAAAAAQAAAAXAAAAAgAAACIAAADDAAAAHQAAAEIAAABDAAAAAAAAABkAAACrAAAAwwAAAMIAAADCAAAAwQAAAAAAAAAAAAAAAAAAAAAAAAAiAAAAwwAAAB0AAABCAAAAQwAAAAAAAAAEAAAAHQAAACEAAAAgAAAAIAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAIgAAAMMAAAAdAAAAQgAAAEMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAjg8AAI4PAACODwAAjg8AAIABAADgYQAA4mEAAAAAAAAAAAAAjgMAAIIDAACAAwAAgEAAAIBAAADwQAAA8H8AAA==">

    <title>Spout Coverage</title>

    <!-- Bootstrap core CSS -->
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <style type="text/css">
html {
  position: relative;
  min-height: 100%;
}
body {
  padding-top: 50px;
  /* Margin bottom by footer height */
  margin-bottom: 60px;
}
#footer {
  position: absolute;
  bottom: 0;
  width: 100%;
  /* Set the fixed height of the footer here */
  height: 60px;
  background-color: #f5f5f5;
}
code.success {
  color: #468847;
  background-color: #dff0d8;
}
    </style>
  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">Spout Coverage</a>
        </div>
      </div>
    </div>

    <div class="container" style="padding-top:50px">

      <table class="table">
        <thead>
          <tr>
            <th>CSV</th>
            <th>Coverage</th>
            <th>Columns</th>
            <th>Columns Missed</th>
          </tr>
        </thead>
        <tbody>
          <% @coverage_results.each do |csv, total_column_count, mapped_column_count| %>
            <tr>
              <td><%= csv %></td>
              <td>
                <% if total_column_count.to_i > 0 %>
                  <%= "%0.02f %" % (mapped_column_count * 100.0 / total_column_count) %>
                <% else %>
                  <span class="text-muted">---</span>
                <% end %>
              </td>
              <td><%= number_with_delimiter( total_column_count ) %></td>
              <td><%= number_with_delimiter( total_column_count - mapped_column_count ) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>

      <table class="table table-bordered table-hover">
        <thead>
          <tr>
            <th>CSV</th>
            <th>Column</th>
            <th>JSON File</th>
            <th>Variable ID</th>
            <th>Variable Type</th>
            <th>Variable Domain</th>
            <th>Values</th>
          </tr>
        </thead>
        <tbody>
          <% @matching_results.each do |csv, column, scr| %>
            <tr>
              <td><code class="<%= 'success' if scr.number_of_errors == 0 %>"><%= csv %></code></td>
              <td><%= column %></td>
              <td>
                <% if scr.file_name_test %>
                  <div class="text-success" style="text-align:center"><span class="glyphicon glyphicon-ok"></span></div>
                <% else %>
                  <span class="text-danger"><code><%= column %>.json</code> missing</span>
                <% end %>
              </td>
              <td>
                <% if scr.file_name_test %>
                  <% if scr.json_id_test %>
                    <code class="success">"id": "<%= column %>"</code>
                  <% else %>
                    <code>"id": <%= scr.json['id'].inspect %></code>
                  <% end %>
                <% end %>
              </td>
              <td>
                <% if scr.file_name_test %>
                  <code class="<%= 'success' if scr.variable_type_test %>">"type": <%= scr.json['type'].inspect %></code>
                <% end %>
              </td>
              <td>
                <% if scr.json['type'] == 'choices' and scr.file_name_test %>
                  <% if scr.domain_test or scr.json['domain'].to_s.strip == '' %>
                    <code class="<%= 'success' if scr.domain_test %>">"domain": <%= scr.json['domain'].inspect %></code>
                  <% else %>
                    <span class="text-danger"><code><%= scr.json['domain'] %>.json</code> missing</span>
                  <% end %>
                <% end %>
              </td>
              <td style="white-space:nowrap">
                <% if scr.json['type'] == 'choices' %>
                  <% if scr.values_test %>
                    <div class="text-success" style="text-align:center"><span class="glyphicon glyphicon-ok"></span></div>
                  <% else %>
                    <% (scr.valid_values + scr.csv_values.compact.sort).uniq.each do |value| %>
                      <code class="<%= 'success' if scr.valid_values.include?(value) %>"><%= value %></code>
                    <% end %>
                  <% end %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>

    </div><!-- /.container -->

    <div id="footer">
      <div class="container">
        <p class="text-muted" style="margin: 20px 0;">Generated by <a href="https://github.com/sleepepi/spout">Spout</a> v<%= Spout::VERSION::STRING %></p>
      </div>
    </div>

</body></html>
